<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROM Vault</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïπÔ∏è</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0a0b10;
    --bg-panel: #0e0f18;
    --bg-card: #12132a;
    --bg-card-hover: #181940;
    --accent: #00e5ff;
    --accent-dim: #00e5ff22;
    --accent-glow: #00e5ff44;
    --accent2: #d500f9;
    --text: #e0e0f0;
    --text-dim: #666a90;
    --border: #1e2035;
    --green: #00ff88;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body, #root { min-height: 100vh; }

  body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--bg-deep);
    color: var(--text);
    overflow-x: hidden;
  }

  /* Scanline overlay */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.06) 2px, rgba(0,0,0,0.06) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 50%, #00e5ff06 0%, transparent 50%),
      radial-gradient(ellipse at 80% 20%, #d500f904 0%, transparent 50%);
    z-index: -1;
  }

  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-deep); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #2a2c50; }

  /* ‚îÄ‚îÄ‚îÄ Layout ‚îÄ‚îÄ‚îÄ */
  .app { max-width: 1400px; margin: 0 auto; padding: 16px 20px; }

  /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
  .header {
    display: flex; align-items: center; justify-content: space-between;
    padding-bottom: 16px; border-bottom: 1px solid var(--border);
    margin-bottom: 16px; flex-wrap: wrap; gap: 12px;
  }
  .logo-area { display: flex; align-items: center; gap: 12px; }
  .logo-box {
    width: 44px; height: 44px; border-radius: 11px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; box-shadow: 0 0 24px var(--accent-dim);
    position: relative;
  }
  .logo-box::after {
    content: ''; position: absolute; inset: 2px;
    background: var(--bg-deep); border-radius: 9px;
  }
  .logo-box span { position: relative; z-index: 1; }
  .app-title {
    font-family: 'Orbitron', sans-serif; font-size: 24px; font-weight: 900;
    letter-spacing: 3px; text-transform: uppercase;
    background: linear-gradient(90deg, var(--accent), #88ddff, var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .header-right { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .stat-badge {
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    color: var(--text-dim); padding: 5px 12px; border: 1px solid var(--border);
    border-radius: 7px; background: var(--bg-panel);
  }
  .stat-val { color: var(--accent); font-weight: 600; }

  /* ‚îÄ‚îÄ‚îÄ Toolbar ‚îÄ‚îÄ‚îÄ */
  .toolbar { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
  .search-wrap { flex: 1; min-width: 200px; position: relative; }
  .search-wrap input {
    width: 100%; padding: 10px 14px 10px 40px;
    background: var(--bg-panel); border: 1px solid var(--border);
    border-radius: 9px; color: var(--text); font-family: 'Rajdhani', sans-serif;
    font-size: 15px; font-weight: 500; outline: none; transition: all 0.3s;
  }
  .search-wrap input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-dim); }
  .search-wrap input::placeholder { color: var(--text-dim); }
  .search-icon { position: absolute; left: 13px; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 16px; pointer-events: none; }
  .tb-btn {
    padding: 8px 15px; background: var(--bg-panel); border: 1px solid var(--border);
    border-radius: 9px; color: var(--text-dim); font-family: 'Rajdhani', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; gap: 6px; white-space: nowrap;
  }
  .tb-btn:hover { border-color: var(--accent); color: var(--accent); background: #00e5ff08; }
  .tb-btn.active { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

  /* ‚îÄ‚îÄ‚îÄ Breadcrumbs ‚îÄ‚îÄ‚îÄ */
  .breadcrumbs {
    display: flex; align-items: center; gap: 2px;
    margin-bottom: 16px; font-size: 13px; font-weight: 500;
    overflow-x: auto; padding-bottom: 4px;
  }
  .crumb {
    color: var(--text-dim); cursor: pointer; padding: 3px 7px;
    border-radius: 5px; transition: all 0.2s; white-space: nowrap;
  }
  .crumb:hover { color: var(--accent); background: #00e5ff12; }
  .crumb.current { color: var(--accent); cursor: default; }
  .crumb.current:hover { background: transparent; }
  .crumb-sep { color: #333555; margin: 0 2px; font-size: 11px; }

  /* ‚îÄ‚îÄ‚îÄ Grid ‚îÄ‚îÄ‚îÄ */
  .content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(215px, 1fr));
    gap: 12px; animation: fadeUp 0.35s ease;
  }
  .content-grid.list-view { grid-template-columns: 1fr; gap: 5px; }

  /* ‚îÄ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ */
  .file-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px; cursor: pointer;
    transition: all 0.22s ease; position: relative; overflow: hidden;
    display: flex; flex-direction: column; gap: 10px;
  }
  .file-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0; transition: opacity 0.3s;
  }
  .file-card:hover {
    border-color: var(--accent); background: var(--bg-card-hover);
    transform: translateY(-2px);
    box-shadow: 0 6px 28px #00e5ff0a, 0 0 0 1px var(--accent-dim);
  }
  .file-card:hover::before { opacity: 1; }

  .icon-wrap {
    width: 50px; height: 50px; border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; flex-shrink: 0;
  }
  .icon-wrap.folder-icon { background: #ffaa0010; border: 1px solid #ffaa0020; }
  .icon-wrap.rom-icon { background: #00e5ff10; border: 1px solid #00e5ff20; }

  .file-name {
    font-size: 14px; font-weight: 600; line-height: 1.3;
    word-break: break-word; color: var(--text);
  }
  .file-meta {
    font-size: 11px; color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
    display: flex; gap: 10px; flex-wrap: wrap;
  }

  .console-tag {
    font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 700;
    padding: 2px 7px; border-radius: 4px; letter-spacing: 1px;
    text-transform: uppercase; display: inline-block; margin-bottom: 3px;
  }

  .dl-btn {
    position: absolute; top: 10px; right: 10px;
    width: 30px; height: 30px; border-radius: 7px;
    background: var(--bg-deep); border: 1px solid var(--border);
    color: var(--text-dim); font-size: 14px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; opacity: 0; transition: all 0.2s; z-index: 2;
    text-decoration: none;
  }
  .file-card:hover .dl-btn { opacity: 1; }
  .dl-btn:hover { background: var(--accent); color: var(--bg-deep); border-color: var(--accent); }

  /* List view */
  .list-view .file-card {
    flex-direction: row; align-items: center;
    padding: 10px 16px; border-radius: 8px; gap: 14px;
  }
  .list-view .icon-wrap { width: 36px; height: 36px; font-size: 18px; border-radius: 8px; }
  .list-view .file-name { flex: 1; }
  .list-view .file-card:hover { transform: translateX(3px) translateY(0); }
  .list-view .dl-btn { position: static; opacity: 1; }

  /* ‚îÄ‚îÄ‚îÄ Loading ‚îÄ‚îÄ‚îÄ */
  .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 20px; gap: 20px; }
  .spinner { width: 42px; height: 42px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
  .loading-text { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--text-dim); animation: pulse 1.5s ease infinite; }

  /* ‚îÄ‚îÄ‚îÄ Empty ‚îÄ‚îÄ‚îÄ */
  .empty-state { text-align: center; padding: 70px 20px; color: var(--text-dim); }
  .empty-state .big-icon { font-size: 56px; margin-bottom: 14px; opacity: 0.5; }
  .empty-state h3 { font-family: 'Orbitron', sans-serif; font-size: 16px; margin-bottom: 6px; color: var(--text); }

  /* ‚îÄ‚îÄ‚îÄ Error ‚îÄ‚îÄ‚îÄ */
  .error-bar {
    background: #ff444418; border: 1px solid #ff444440;
    border-radius: 9px; padding: 10px 16px; margin-bottom: 14px;
    color: #ff6666; font-size: 13px; display: flex; align-items: center; gap: 8px;
  }

  /* ‚îÄ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.88);
    backdrop-filter: blur(8px); z-index: 1000;
    display: flex; align-items: center; justify-content: center;
    padding: 20px; animation: fadeIn 0.2s ease;
  }
  .modal-content {
    background: var(--bg-panel); border: 1px solid var(--border);
    border-radius: 16px; padding: 30px; max-width: 480px;
    width: 100%; position: relative;
  }
  .modal-close {
    position: absolute; top: 14px; right: 14px;
    width: 34px; height: 34px; border-radius: 9px;
    background: var(--bg-card); border: 1px solid var(--border);
    color: var(--text-dim); font-size: 18px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
  }
  .modal-close:hover { background: #ff444425; border-color: #ff4444; color: #ff4444; }
  .modal-title {
    font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700;
    margin-bottom: 18px; padding-right: 40px; word-break: break-word; line-height: 1.5;
  }
  .detail-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 9px 0; border-bottom: 1px solid #ffffff06; font-size: 13px;
  }
  .detail-label { color: var(--text-dim); }
  .detail-value { font-weight: 600; }
  .modal-actions { display: flex; gap: 8px; margin-top: 22px; }
  .modal-btn {
    flex: 1; padding: 11px; border-radius: 9px;
    font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 700;
    cursor: pointer; text-align: center; text-decoration: none;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    transition: all 0.2s; border: none;
  }
  .modal-btn.primary {
    background: linear-gradient(135deg, var(--accent), #0088ff);
    color: var(--bg-deep);
  }
  .modal-btn.primary:hover { box-shadow: 0 4px 20px var(--accent-dim); transform: translateY(-1px); }
  .modal-btn.secondary {
    background: var(--bg-card); color: var(--text);
    border: 1px solid var(--border);
  }
  .modal-btn.secondary:hover { border-color: var(--accent); color: var(--accent); }

  /* ‚îÄ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ‚îÄ */
  @media (max-width: 768px) {
    .app { padding: 10px 12px; }
    .app-title { font-size: 18px; letter-spacing: 1px; }
    .content-grid { grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 8px; }
    .file-card { padding: 12px; }
    .icon-wrap { width: 40px; height: 40px; font-size: 20px; }
  }
  @media (max-width: 480px) {
    .content-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
    .header-right .stat-badge { display: none; }
  }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

const API_KEY = "AIzaSyBFUMKDNIeYM74W-Ub_VS7fFuFX6NFq0Wc";
const ROOT_FOLDER_ID = "1S3xtWVAYdcHPkDi7DhgLbiNUBRZr4CNG";

const CONSOLE_MAP = {
  nes:  { tag: "NES",  color: "#ff4444", bg: "#ff444418", exts: [".nes"], icon: "üü•" },
  snes: { tag: "SNES", color: "#aa77ff", bg: "#aa77ff18", exts: [".sfc", ".smc"], icon: "üü™" },
  n64:  { tag: "N64",  color: "#00cc66", bg: "#00cc6618", exts: [".z64", ".n64", ".v64"], icon: "üü©" },
  gb:   { tag: "GB",   color: "#5599cc", bg: "#5599cc18", exts: [".gb"], icon: "üîµ" },
  gbc:  { tag: "GBC",  color: "#ffcc33", bg: "#ffcc3318", exts: [".gbc"], icon: "üü°" },
  gba:  { tag: "GBA",  color: "#9966ff", bg: "#9966ff18", exts: [".gba"], icon: "üü£" },
  nds:  { tag: "NDS",  color: "#ff6699", bg: "#ff669918", exts: [".nds"], icon: "üíó" },
  gen:  { tag: "GEN",  color: "#3399ff", bg: "#3399ff18", exts: [".md", ".gen", ".smd"], icon: "üî∑" },
  psx:  { tag: "PSX",  color: "#999",    bg: "#99999918", exts: [".iso", ".bin", ".cue", ".img"], icon: "‚¨ú" },
  "3ds":{ tag: "3DS",  color: "#ff8844", bg: "#ff884418", exts: [".3ds", ".cia"], icon: "üüß" },
};

function detectConsole(filename, parentName) {
  const fn = filename.toLowerCase();
  const pn = (parentName || "").toLowerCase();
  for (const [, val] of Object.entries(CONSOLE_MAP)) {
    for (const ext of val.exts) { if (fn.endsWith(ext)) return val; }
  }
  for (const [key, val] of Object.entries(CONSOLE_MAP)) {
    if (pn.includes(key) || pn.includes(val.tag.toLowerCase())) return val;
  }
  const kwMap = {
    "super nintendo": "snes", "super famicom": "snes", "gameboy advance": "gba",
    "game boy advance": "gba", "gameboy color": "gbc", "game boy color": "gbc",
    "gameboy": "gb", "game boy": "gb", "nintendo 64": "n64", "nintendo ds": "nds",
    genesis: "gen", "mega drive": "gen", playstation: "psx",
  };
  for (const [kw, key] of Object.entries(kwMap)) {
    if (fn.includes(kw) || pn.includes(kw)) return CONSOLE_MAP[key];
  }
  return null;
}

function formatSize(bytes) {
  if (!bytes) return "‚Äî";
  const b = parseInt(bytes);
  if (b < 1024) return b + " B";
  if (b < 1048576) return (b / 1024).toFixed(1) + " KB";
  if (b < 1073741824) return (b / 1048576).toFixed(1) + " MB";
  return (b / 1073741824).toFixed(2) + " GB";
}

function formatDate(d) {
  if (!d) return "‚Äî";
  return new Date(d).toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" });
}

function App() {
  const [files, setFiles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [folderHistory, setFolderHistory] = useState([{ id: ROOT_FOLDER_ID, name: "ROM Library" }]);
  const [search, setSearch] = useState("");
  const [listView, setListView] = useState(false);
  const [sortMode, setSortMode] = useState("name-asc");
  const [filterMode, setFilterMode] = useState("all");
  const [selectedFile, setSelectedFile] = useState(null);
  const cacheRef = useRef({});
  const searchRef = useRef(null);

  const currentFolder = folderHistory[folderHistory.length - 1];

  const loadFolder = useCallback(async (folderId) => {
    setLoading(true);
    setError(null);
    setSearch("");

    if (cacheRef.current[folderId]) {
      setFiles(cacheRef.current[folderId]);
      setLoading(false);
      return;
    }

    try {
      let allFiles = [];
      let pageToken = "";
      do {
        const q = encodeURIComponent(`'${folderId}' in parents and trashed=false`);
        const fields = encodeURIComponent(
          "nextPageToken,files(id,name,mimeType,size,modifiedTime,webContentLink,webViewLink)"
        );
        let url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=${fields}&key=${API_KEY}&pageSize=1000&orderBy=folder,name`;
        if (pageToken) url += `&pageToken=${pageToken}`;
        const resp = await fetch(url);
        if (!resp.ok) {
          const e = await resp.json();
          throw new Error(e.error?.message || "Failed to load files");
        }
        const data = await resp.json();
        allFiles = allFiles.concat(data.files || []);
        pageToken = data.nextPageToken || "";
      } while (pageToken);

      cacheRef.current[folderId] = allFiles;
      setFiles(allFiles);
    } catch (e) {
      setError(e.message);
      setFiles([]);
    }
    setLoading(false);
  }, []);

  useEffect(() => { loadFolder(ROOT_FOLDER_ID); }, [loadFolder]);

  useEffect(() => {
    const handler = (e) => {
      if (e.key === "/" && document.activeElement.tagName !== "INPUT") {
        e.preventDefault();
        searchRef.current?.focus();
      }
      if (e.key === "Escape") setSelectedFile(null);
      if (e.altKey && e.key === "ArrowLeft" && folderHistory.length > 1) {
        const prev = folderHistory[folderHistory.length - 2];
        navigateTo(prev.id, prev.name);
      }
    };
    window.addEventListener("keydown", handler);
    return () => window.removeEventListener("keydown", handler);
  }, [folderHistory]);

  const navigateTo = (folderId, folderName) => {
    const idx = folderHistory.findIndex((f) => f.id === folderId);
    let newHistory;
    if (idx >= 0) {
      newHistory = folderHistory.slice(0, idx + 1);
    } else {
      newHistory = [...folderHistory, { id: folderId, name: folderName }];
    }
    setFolderHistory(newHistory);
    loadFolder(folderId);
  };

  const refresh = () => {
    delete cacheRef.current[currentFolder.id];
    loadFolder(currentFolder.id);
  };

  const sortModes = ["name-asc", "name-desc", "size-desc", "size-asc", "date-desc", "date-asc"];
  const sortLabels = {
    "name-asc": "A‚ÜíZ", "name-desc": "Z‚ÜíA", "size-desc": "Size ‚Üì",
    "size-asc": "Size ‚Üë", "date-desc": "Newest", "date-asc": "Oldest"
  };
  const cycleSort = () => {
    const i = (sortModes.indexOf(sortMode) + 1) % sortModes.length;
    setSortMode(sortModes[i]);
  };

  // Filter & sort
  let displayed = [...files];
  if (search) displayed = displayed.filter((f) => f.name.toLowerCase().includes(search.toLowerCase()));
  if (filterMode === "rom") displayed = displayed.filter((f) => f.mimeType !== "application/vnd.google-apps.folder");
  if (filterMode === "folder") displayed = displayed.filter((f) => f.mimeType === "application/vnd.google-apps.folder");

  const folders = displayed.filter((f) => f.mimeType === "application/vnd.google-apps.folder");
  const roms = displayed.filter((f) => f.mimeType !== "application/vnd.google-apps.folder");

  const sortFn = (a, b) => {
    switch (sortMode) {
      case "name-asc": return a.name.localeCompare(b.name);
      case "name-desc": return b.name.localeCompare(a.name);
      case "size-asc": return (parseInt(a.size) || 0) - (parseInt(b.size) || 0);
      case "size-desc": return (parseInt(b.size) || 0) - (parseInt(a.size) || 0);
      case "date-desc": return new Date(b.modifiedTime) - new Date(a.modifiedTime);
      case "date-asc": return new Date(a.modifiedTime) - new Date(b.modifiedTime);
      default: return 0;
    }
  };
  folders.sort(sortFn);
  roms.sort(sortFn);
  const sorted = [...folders, ...roms];
  const totalSize = roms.reduce((s, f) => s + (parseInt(f.size) || 0), 0);

  return (
    <div className="app">
      {/* Header */}
      <div className="header">
        <div className="logo-area">
          <div className="logo-box"><span>üïπÔ∏è</span></div>
          <div className="app-title">ROM Vault</div>
        </div>
        <div className="header-right">
          <span className="stat-badge"><span className="stat-val">{roms.length}</span> ROMs</span>
          <span className="stat-badge"><span className="stat-val">{folders.length}</span> folders</span>
          {totalSize > 0 && (
            <span className="stat-badge"><span className="stat-val">{formatSize(totalSize)}</span> total</span>
          )}
          <button className="tb-btn" onClick={refresh}>üîÑ Refresh</button>
        </div>
      </div>

      {/* Toolbar */}
      <div className="toolbar">
        <div className="search-wrap">
          <span className="search-icon">üîç</span>
          <input
            ref={searchRef}
            placeholder='Search ROMs... (press "/")'
            value={search}
            onChange={(e) => setSearch(e.target.value)}
          />
        </div>
        <button className="tb-btn" onClick={() => setListView(!listView)}>
          {listView ? "‚ñ¶ Grid" : "‚ñ§ List"}
        </button>
        <button className="tb-btn" onClick={cycleSort}>‚Üï {sortLabels[sortMode]}</button>
        {["all", "rom", "folder"].map((m) => (
          <button
            key={m}
            className={`tb-btn${filterMode === m ? " active" : ""}`}
            onClick={() => setFilterMode(m)}
          >
            {m === "all" ? "All" : m === "rom" ? "ROMs" : "Folders"}
          </button>
        ))}
      </div>

      {/* Breadcrumbs */}
      <div className="breadcrumbs">
        {folderHistory.map((f, i) => {
          const isLast = i === folderHistory.length - 1;
          return (
            <React.Fragment key={f.id + i}>
              <span
                className={`crumb${isLast ? " current" : ""}`}
                onClick={() => !isLast && navigateTo(f.id, f.name)}
              >
                {i === 0 ? "üè† " : ""}{f.name}
              </span>
              {!isLast && <span className="crumb-sep">‚Ä∫</span>}
            </React.Fragment>
          );
        })}
      </div>

      {/* Error */}
      {error && <div className="error-bar">‚ö†Ô∏è {error}</div>}

      {/* Content */}
      {loading ? (
        <div className="loading">
          <div className="spinner" />
          <div className="loading-text">Loading ROM library...</div>
        </div>
      ) : sorted.length === 0 ? (
        <div className="empty-state">
          <div className="big-icon">{search ? "üîç" : "üìÇ"}</div>
          <h3>{search ? "No matches found" : "Empty Folder"}</h3>
          <p>{search ? "Try a different search term" : "This folder has no files"}</p>
        </div>
      ) : (
        <div className={`content-grid${listView ? " list-view" : ""}`}>
          {sorted.map((f) => {
            const isFolder = f.mimeType === "application/vnd.google-apps.folder";
            const ci = !isFolder ? detectConsole(f.name, currentFolder.name) : null;
            const dlLink = f.webContentLink || `https://drive.google.com/uc?export=download&id=${f.id}`;

            return (
              <div
                key={f.id}
                className="file-card"
                onClick={() => isFolder ? navigateTo(f.id, f.name) : setSelectedFile(f)}
              >
                {!isFolder && (
                  <a
                    href={dlLink}
                    target="_blank"
                    rel="noreferrer"
                    className="dl-btn"
                    onClick={(e) => e.stopPropagation()}
                    title="Download"
                  >‚¨á</a>
                )}
                <div className={`icon-wrap ${isFolder ? "folder-icon" : "rom-icon"}`}>
                  {isFolder ? "üìÅ" : (ci?.icon || "üéÆ")}
                </div>
                <div style={{ flex: listView ? 1 : undefined, minWidth: 0 }}>
                  {ci && (
                    <span
                      className="console-tag"
                      style={{
                        background: ci.bg,
                        color: ci.color,
                        border: `1px solid ${ci.color}33`
                      }}
                    >{ci.icon} {ci.tag}</span>
                  )}
                  <div className="file-name">{f.name}</div>
                  <div className="file-meta">
                    <span>{isFolder ? "Folder" : formatSize(f.size)}</span>
                    <span>{formatDate(f.modifiedTime)}</span>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      )}

      {/* Modal */}
      {selectedFile && (
        <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && setSelectedFile(null)}>
          <div className="modal-content">
            <button className="modal-close" onClick={() => setSelectedFile(null)}>‚úï</button>
            <div className="modal-title">{selectedFile.name}</div>
            {(() => {
              const ci = detectConsole(selectedFile.name, currentFolder.name);
              const ext = selectedFile.name.includes(".")
                ? selectedFile.name.split(".").pop().toUpperCase() : "‚Äî";
              const dlLink = selectedFile.webContentLink ||
                `https://drive.google.com/uc?export=download&id=${selectedFile.id}`;
              const viewLink = selectedFile.webViewLink ||
                `https://drive.google.com/file/d/${selectedFile.id}/view`;
              return (
                <>
                  {ci && (
                    <div className="detail-row">
                      <span className="detail-label">Console</span>
                      <span
                        className="console-tag"
                        style={{ background: ci.bg, color: ci.color, border: `1px solid ${ci.color}33` }}
                      >{ci.icon} {ci.tag}</span>
                    </div>
                  )}
                  <div className="detail-row">
                    <span className="detail-label">Size</span>
                    <span className="detail-value">{formatSize(selectedFile.size)}</span>
                  </div>
                  <div className="detail-row">
                    <span className="detail-label">Format</span>
                    <span className="detail-value">.{ext}</span>
                  </div>
                  <div className="detail-row">
                    <span className="detail-label">Modified</span>
                    <span className="detail-value">{formatDate(selectedFile.modifiedTime)}</span>
                  </div>
                  <div className="detail-row">
                    <span className="detail-label">Type</span>
                    <span className="detail-value" style={{ fontSize: 11, wordBreak: "break-all" }}>
                      {selectedFile.mimeType}
                    </span>
                  </div>
                  <div className="modal-actions">
                    <a href={dlLink} target="_blank" rel="noreferrer" className="modal-btn primary">
                      ‚¨á Download
                    </a>
                    <a href={viewLink} target="_blank" rel="noreferrer" className="modal-btn secondary">
                      üëÅ View in Drive
                    </a>
                  </div>
                </>
              );
            })()}
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
